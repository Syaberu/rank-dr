<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>DeathRun Official Tier</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <div id="sound-control-panel">
        <div class="panel-content">
            <button id="mute-btn" style="background:none; border:none; cursor:pointer; font-size:1.2rem;">ðŸ”Š</button>
            <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.5">
            <span id="vol-txt">50%</span>
        </div>
    </div>

    <div class="container">
        <h1 style="text-align:center; font-size:3rem; text-shadow:0 0 20px var(--neon-cyan);">TOP RUNNERS</h1>
        
        <div style="margin-bottom: 20px; display:flex; gap:10px; justify-content:center;">
            <button class="neon-btn" onclick="renderRanking('rating')">Ratingé †</button>
            <button class="neon-btn" onclick="renderRanking('tier')">Tieré †</button>
            <input type="text" id="search" placeholder="Player Search..." oninput="searchPlayer()">
        </div>

        <div id="ranking-list"></div>
    </div>

    <script src="data.js"></script>
    <script>
        // --- SoundManager Class ---
        class SoundManager {
            constructor() {
                this.volume = localStorage.getItem('volume') || 0.5;
                this.isMuted = localStorage.getItem('muted') === 'true';
                this.sounds = {
                    startup: new Audio('sounds/startup.mp3'),
                    hover: new Audio('sounds/hover.mp3'),
                    click: new Audio('sounds/click.mp3'),
                    rank: new Audio('sounds/rank.mp3'),
                    win: new Audio('sounds/win.mp3'),
                    button: new Audio('sounds/button.mp3')
                };
                this.init();
            }

            init() {
                document.getElementById('volume-slider').value = this.volume;
                this.updateUI();
                
                // åˆå›žã‚¯ãƒªãƒƒã‚¯æ™‚ã«startupã‚’å†ç”Ÿï¼ˆãƒ–ãƒ©ã‚¦ã‚¶åˆ¶é™è§£é™¤ï¼‰
                document.addEventListener('mousedown', () => {
                    if(!this.started) { this.playSound('startup'); this.started = true; }
                }, {once: true});
            }

            playSound(type) {
                if(this.isMuted) return;
                const s = this.sounds[type];
                if(s) {
                    s.currentTime = 0;
                    s.volume = this.volume;
                    s.play().catch(e => {});
                }
            }

            setVolume(val) {
                this.volume = val;
                localStorage.setItem('volume', val);
                this.updateUI();
            }

            toggleMute() {
                this.isMuted = !this.isMuted;
                localStorage.setItem('muted', this.isMuted);
                this.updateUI();
            }

            updateUI() {
                document.getElementById('vol-txt').innerText = Math.round(this.volume * 100) + "%";
                document.getElementById('mute-btn').innerText = this.isMuted ? "ðŸ”‡" : "ðŸ”Š";
            }
        }

        const sm = new SoundManager();

        // --- Ranking Logic ---
        function renderRanking(mode = 'tier') {
            const list = document.getElementById('ranking-list');
            list.innerHTML = "";

            // ã‚½ãƒ¼ãƒˆãƒ­ã‚¸ãƒƒã‚¯
            let sorted = [...players];
            if(mode === 'tier') {
                sorted.sort((a, b) => getTierScore(b.tier) - getTierScore(a.tier) || b.rating - a.rating);
            } else {
                sorted.sort((a, b) => b.rating - a.rating);
            }

            sorted.forEach((p, i) => {
                const rank = i + 1;
                const winRate = ((p.wins / p.matches) * 100).toFixed(1);
                const tierClass = p.tier.startsWith('HT') ? 'badge-ht' : 'badge-lt';
                
                const card = document.createElement('a');
                card.href = `player.html?name=${encodeURIComponent(p.name)}`;
                card.className = `player-card rank-${rank <= 3 ? rank : 'normal'}`;
                
                let rankDisplay = `#${rank}`;
                if(rank === 1) rankDisplay = `<span class="crown">ðŸ‘‘</span>`;
                if(rank === 2) rankDisplay = `ðŸ¥ˆ`;
                if(rank === 3) rankDisplay = `ðŸ¥‰`;

                card.innerHTML = `
                    <div style="width:50px; font-weight:bold; font-size:1.2rem;" class="rank-num">${rankDisplay}</div>
                    <img src="skins/${p.name}.png" onerror="this.src='skins/default.png'" class="skin-icon">
                    <div style="flex-grow:1">
                        <div style="font-size:1.1rem; font-weight:bold;">${p.name}</div>
                        <div style="font-size:0.8rem; color:#aaa;">Matches: ${p.matches} | WinRate: ${winRate}%</div>
                    </div>
                    <div style="text-align:right">
                        <div class="tier-badge ${tierClass}">${p.tier}</div>
                        <div style="margin-top:5px; color:var(--neon-cyan); font-weight:bold;">${p.rating} pt</div>
                    </div>
                `;

                // ã‚¤ãƒ™ãƒ³ãƒˆ
                card.onmouseenter = () => sm.playSound('hover');
                card.onclick = () => sm.playSound('click');

                list.appendChild(card);
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º
                setTimeout(() => card.classList.add('show'), i * 50);
            });

            if(mode === 'tier') sm.playSound('rank');
        }

        // éŸ³é‡ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
        document.getElementById('volume-slider').oninput = (e) => sm.setVolume(e.target.value);
        document.getElementById('mute-btn').onclick = () => { sm.toggleMute(); sm.playSound('button'); };

        window.onload = () => renderRanking('tier');
    </script>
</body>
</html>
